;
; Are nmrPipe spectra with transposed dimensions interpreted correctly?
;

(define (spectrum-grab-point spec x y z)
  (spectrum-peek
   (spectrum-project-pt
    (spectrum-project-pt
     (spectrum-project-pt spec x) y) z) 0))

(define spec     (spectrum-nih-from-file (example-spectrum-path "cbcaconh.DAT")))
(define spec-zyx (spectrum-nih-from-file (example-spectrum-path "cbcaconh-zyx.DAT")))

(define (test-point x y z)
  (and (= (spectrum-grab-point spec x y z)
	  (spectrum-grab-point spec-zyx z y x))))

(expect-fail "untransposed indices with transposed spectra"
 (= (spectrum-grab-point spec 13 20 5)
    (spectrum-grab-point spec-zyx 13 20 5)))

(pass-if "transposed indices matching transposed data"
	 (and (test-point 22 15 9)
	      (test-point 3 19 20)
	      (test-point 1 24 2)))




(define (parameter-test name op)
  (pass-if name
    (and
     (= (op spec 0)(op spec-zyx 2))
     (= (op spec 1)(op spec-zyx 1))
     (= (op spec 2)(op spec-zyx 0)))))

(parameter-test "transposed sweep width"        spectrum-sw)
(parameter-test "transposed carrier frequency"  spectrum-sf)
(parameter-test "transposed number of points"   spectrum-np)
(parameter-test "transposed origin"             spectrum-orig)
